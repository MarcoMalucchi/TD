import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

# ------------------------------------------------------
# Parametri dell'ellissoide dati dal fit
# ------------------------------------------------------
Q = np.array([
    [ 1.44475546e-05,  1.20374489e-08, -2.43933766e-08],
    [ 1.20374489e-08,  1.41683711e-05, -6.15215370e-08],
    [-2.43933766e-08, -6.15215370e-08,  1.54483299e-05]])

p = np.array([-1.20417864e-05, -5.09214852e-05, -5.06165166e-05])
f = -0.9996395885125718

# ------------------------------------------------------
# Inserisci qui i tuoi samples (Nx3)
# ------------------------------------------------------
samples = np.array([
    [11.2255554, 5.96777773, 257.727234],
    [4.25166655, -128.496674, 223.462784],
    [-0.254999995, -227.719452, 127.562775],
    [-6.14777756, -261.195007, 1.30166662],
    [-10.499444, -226.958328, -125.208885],
    [-10.3416662, -153.233887, -201.639999],
    [-6.64333344, -1.00999999, -251.503326],
    [93.6483307, -124.360558, 207.028885],
    [135.293884, -198.282227, 102.360558],
    [143.588333, -219.46167, 3.05500007],
    [122.472221, -193.331665, -123.21167],
    [69.547226, -121.167778, -211.768326],
    [110.984444, -40.3622208, 231.157227],
    [211.991669, -94.5144424, 122.334442],
    [238.338882, -112.373337, -5.52388906],
    [198.76445, -98.7755585, -131.535553],
    [119.55278, -62.1988907, -215.508331],
    [139.5961fig = plt.figure(figsize=(10,8))
ax = fig.add_subplot(111, projection='3d')
15, 32.2166672, 217.830002],
    [229.163895, 45.9488907, 124.412224],
    [259.51944, 48.5294456, -2.17722225],
    [209.520004, 36.8738899, -147.443893],
    [118.487221, 18.9150009, -223.677216],
    [94.4505539, 103.845558, 221.652771],
    [154.65834, 167.815552, 137.12056],
    [182.384995, 195.299438, -12.5794449],
    [133.514999, 145.704437, -168.218338],
    [83.1549988, 93.8388901, -221.743896],
    [-70.7616653, -104.410004, 224.899994],
    [-123.99778, -171.287216, 152.018326],
    [-155.968887, -209.281113, 2.4311111],
    [-132.907776, -175.938889, -133.232224],
    [-79.1811142, -99.2238922, -218.349442],
    [-127.923889, -28.5499992, 222.902222],
    [-220.097229, -51.7144432, 129.515549],
    [-255.118332, -60.3266678, 2.59944439],
    [-212.151672, -49.5094452, -137.059448],
    [-123.545555, -26.7544441, -219.734451],
    [-132.657776, 58.5716667, 216.108887],
    [-210.039444, 85.2483368, 132.058334],
    [-246.525558, 96.6227798, 5.05166674],
    [-204.941116, 78.3733368, -136.715561],
    [-118.137779, 44.5827789, -220.451111],
    [-81.7694473, 137.626114, 207.67334],
    [-126.416664, 200.743332, 122.91333],
    [-144.422226, 225.23056, -0.555000007],
    [-126.511665, 190.539444, -130.134445],
    [-82.6144409, 122.567223, -208.589447],
    [12.8716669, 143.184448, 219.701111],
    [17.5577774, 231.39389, 133.891663],
    [17.6855564, 268.776123, -2.80444455],
    [12.1505556, 223.978882, -137.929443],
    [4.74333334, 141.865555, -212.71611],
    [-3.46166658, 0.237777784, -250.835007]
])

# ------------------------------------------------------
# Classificazione dei punti
# ------------------------------------------------------
def gfun(x):
    return x @ Q @ x + 2 * p @ x + f

vals = np.array([gfun(x) for x in samples])

eps = 0.0005  # tolleranza superficie
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

inside = samples[vals < -eps]
surface = samples[np.abs(vals) <= eps]
outside = samples[vals > eps]

print("Dentro:", inside.shape[0])
print("Sulla superficie:", surface.shape[0])
print("Fuori:", outside.shape[0])

# ------------------------------------------------------
# PLOT 3D
# ------------------------------------------------------
fig = plt.figure(figsize=(10,8))
ax = fig.add_subplot(111, projection='3d')

if len(inside)>0:
    ax.scatter(inside[:,0], inside[:,1], inside[:,2], c='green', s=25, label='Inside')

if len(surface)>0:
    ax.scatter(surface[:,0], surface[:,1], surface[:,2], c='blue', s=40, label='On surface')

if len(outside)>0:
    ax.scatter(outside[:,0], outside[:,1], outside[:,2], c='red', s=25, label='Outside')

ax.set_xlabel('X')
ax.set_ylabel('Y')
ax.set_zlabel('Z')
ax.legend()
ax.set_title('Samples classified wrt ellipsoid')

plt.show()
